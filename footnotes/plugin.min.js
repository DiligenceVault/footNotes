String.prototype.supplant||(String.prototype.supplant=function(t){return this.replace(/{([^{}]*)}/g,function(n,e){var o=t[e];return"string"==typeof o||"number"==typeof o?o:n})}),tinymce.PluginManager.add("footnotes",function(t){function n(){var n=t.selection.getNode(),e="",o="SPAN"==n.tagName&&"wiki-fnote"===t.dom.getAttrib(n,"class"),i=function(){if("wiki-fnote"==n.className){var t=n.childNodes[0].firstChild.nodeValue.replace(/[^0-9]/g,"");return console.log(t),t}return n.childNodes[0]}();o&&(e=n.name||decodeURIComponent(n.childNodes[0].getAttribute("data-content"))||""),t.windowManager.open({title:"Add a footnote",id:"footnote-dialog",body:{type:"textbox",name:"name",multiline:!0,minWidth:520,minHeight:100,value:e},onSubmit:function(n){function e(t){function n(t,n){for(var i=e(n);0!=i.length;){var a=o(t,i);if(null!=a)return a;i=e(i)}return i}function e(t){return t.nextAll().find(".wiki-fnotepop").length>0?t.next().hasClass("wiki-fnotepop")?t.next().children().children():t.nextAll().find(".wiki-fnotepop"):"BODY"==t.prop("nodeName")?[]:e(t.parent())}function o(t,n){if(!n)return!1;if(n)return n;var e=null;return n.children().each(function(){n&&(e=o(t,$(this)))}),e}var i=n(".wiki-fnotepop",t);return i}var o,a='<span data-cls="foot" class="wiki-fnote" id="#wk_ft{FOOTNOTE_INDEX}" contentEditable="false"><button class="wiki-fnotepop" data-container=".wiki-fnote"  data-placement="auto bottom" data-content="{FOOTNOTE}">{FOOTNOTE_INDEX}</button></span>&nbsp;',l=t.getDoc().querySelectorAll(".wiki-fnotepop"),r=(t.getDoc().querySelectorAll(".wiki-fnote"),l.length),c=n.data.name,f=function(){return encodeURIComponent(c)}(),p=e($(t.selection.getRng().endContainer));if(p.length){p=p[0];var s;for(s=0;s<r&&p!=l[s];s++);i<r?o=a.supplant({FOOTNOTE:f,FOOTNOTE_INDEX:$(l[i-1]).html()}):(o=a.supplant({FOOTNOTE:f,FOOTNOTE_INDEX:$(l[s]).html()}),t.selection.collapse(0))}else o=a.supplant({FOOTNOTE:f,FOOTNOTE_INDEX:r+1}),t.selection.collapse(0);t.execCommand("mceInsertContent",!1,o),$(t.getDoc()).find(".wiki-fnotepop").each(function(t){$(this).text(t+1),$(this).parent().attr("id","#wk_ft"+(t+1))})}})}t.addCommand("mceFootnotes",n),t.addButton("footnotes",{title:"각주",image:tinyMCE.baseURL+"/plugins/footnotes/img/footnotes.png",onclick:n,stateSelector:"span.wiki-fnote"})});